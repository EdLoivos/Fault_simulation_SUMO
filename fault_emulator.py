from bs4 import BeautifulSoup
import random

net = ["-1012182101","-1074922213#0","-1074922213#1","-1074951848#1","-1074953686","-1074957931","-1074958874#1","-122540894","-122604288","-122604291#0","-122604291#1","-122604291#2","-122604291#3","-122604292#0","-122604292#1","-123754779","-123754782","-167647200","-167647201","-167647203","-167647204","-167662032","-182091712#0","-182091712#1","-182476447","-182485938","-182485939","-182638845","-182642936","-183035151","-183035152","-183040112#0",
"-183040112#1","-183872329","-184292231","-184972762#0","-184972762#1","-230749049","-238252407","-238253232#0","-238253232#1","-238472881","-238472895","-252517188","-257068293#0","-257068293#1","-257069682","-259198589","-263521177#0","-263521177#1","-27459092#0","-27459092#1","-283382275","-283382277#0","-283382277#1","-29143586","-29279814","-29279824","-29279828","-29424438#0","-29424438#1","-29424438#2","-29424453",
"-29424511#0","-29424511#1","-29424511#2","-29424514","-29424578#0","-29424578#1","-29424578#2","-29424578#3","-29424709#0","-29424709#1","-29424728","-29424741","-295688694","-30455310","-30455312#1","-310250930","-33637798","-33888624","-455323175","-479790499","-513725891#1","-522211508#0","-522211508#1","-569567317#0","-569567317#1","-591863728","-620714856#0","-620714856#1","-620714857","-630309656","-630309658","-630313202","-720669944",
"-720669945","-720669946","-834913281","-836979909","-837014539","-859849281","-859853022#0","-859853022#2","-863539560","-952095307","-952099093","-952099094","-952110257","-952398598","-952468789","-955082739","-955124572","-955400312","-968750254","-972438415","-993169805#0","-993169805#1","-993169805#2","-993169805#3","-995042163","-999606366","1012182101","1074647721","1074651890","1074651891","1074654092",
"1074913133","1074913134","1074918064#0","1074918064#1","1074918065#0","1074922213#0","1074922213#1","1074922214#1","1074926095","1074933670","1074945748","1074947634","1074949369","1074951848#1","1074953686","1074957931","1074958874#1","1078333569#0","1078333569#1","1078333571","1078333935","1078334337","1078334339","1102758010#0","1138532793","1173518034#0","1173518034#1","122059408#0","122540888#1","122540892","122540894","122540897","122540898","122540902#0",
"122540902#1","122540902#2","122540905","122540912","122604288","122604290","122604291#0","122604291#1","122604291#2","122604291#3","122604292#0","122604292#1","123754729#0","123754729#1","123754731","123754733#1","123754735#0","123754735#1","123754735#2","123754737","123754739","123754742","123754743#0","123754743#1","123754743#10","123754743#2","123754743#3","123754743#4","123754743#7","123754743#8","123754743#9","123754747","123754748#0","123754748#1",
"123754750","123754756#0","123754756#1","123754756#2","123754756#3","123754756#4","123754756#5","123754757#0","123754757#1","123754762#0","123754762#1","123754762#2","123754762#3","123754762#4","123754762#5","123754762#6","123754762#7","123754762#8","123754762#9","123754765","123754767#0","123754767#1","123754770#0","123754770#1","123754772#0","123754772#1","123754772#2","123754775#0","123754775#1","123754775#2","123754779","123754782","123754785",
"123754787#2","123754792#0","123754795#0","123754795#1","123754795#2","123755329#1","123755331#0","123755331#1","123755331#2","123755335","123755766#0","123755766#1","123755766#2","123755766#5","123755771#0","123755771#1","123755771#2","123755771#3","123755771#4","123755771#5","123755771#6","123755771#7","123755771#8","123755776#0","123755776#1","123755776#3","123755776#4","123755776#6","123755777#0","123755777#1","123755777#2","123756560#0","123756560#1","123973547#1",
"123973547#2","125250709","125250712","125250723","156332676#1","156333767","156333769#0","156333769#1","156333769#2","156333769#4","156334955","156334960","161220479#0","161220479#1","161220479#2","161220480#0","161220480#1","161220480#2","167647200","167647201","167647203","167647204","167662032","182091712#0","182091712#1","182476447","182481063#0","182481063#1","182481063#2","182481063#3","182481066#0","182481066#1","182481072","182481074","182481075","182485053","182485938",
"182485939","182638845","182642933","182642934","182642936","182642940","182642963#0","182642963#1","182642963#3","182642963#4","182642963#5","182717861","182775137#0","182775137#1","182779371","183035151","183035370#0","183035371#0","183035371#1","183035373#0","183039799","183040112#0","183040112#1","183040113","183044493#0","183044493#2","183044493#3","183044497","183044499","183044501","183092431#0","183092431#1","183092431#2","183092431#3","183092431#4","183176599","183176600",
"183872329","184292231","184972762#0","184972762#1","196946121#0","196946121#1","196946933#0","196947004","196947164","196947165#0","196947165#1","196947165#2","196947165#3","196947165#4","196947165#5","196947165#6","196947165#7","201161360","223637472#0","223637472#1","230749049","238252407","238253232#0","238253232#1","238472881","238472895","252517169","252517170#0","252517170#1","252517174#0","252517174#1","252517174#2",
"252517188","252517196","252517200#0","252517200#1","252517200#2","256628632","256628634#0","257068293#0","257068293#1","257069681","257069682","257069684","259180962#1","259193744","259198589","259219378","260962953#0","260962953#1","261260364","261404914#0","261404914#1","261404914#2","261404914#3","261406222","261869985","261870092","261870300#0","262673021","262674450","263515377","263516312#0","263516312#1","263521177#0","263521177#1","263791892","263791893","263791914",
"263794661","263794662#1","263794662#2","263794663","263943680#0","263943680#1","263943770","27458928#0","27458928#1","27458928#3","27459085#0","27459085#1","27459085#2","27459085#3","27459085#4","27459085#5","27459085#6","27459085#7","27459092#0","27459092#1","27459106#0","27459106#1","27474439#0","27474439#1","27474604#0","27474604#1","27474604#2","27474604#3","27474659#0","27474659#2","283382275","283382277#0","283382277#1","29143586","29145168","29145270#0","29145270#1",
"29279814","29279824","29279828","29424361#0","29424438#0","29424438#1","29424438#2","29424453","29424511#0","29424511#1","29424511#2","29424514","29424540#0","29424540#1","29424540#2","29424578#0","29424578#1","29424578#2","29424578#3","29424709#0","29424709#1","29424728","29424741","30359735#0","30359735#1","30359735#2","30441852","30441853#0","30441853#1","30441853#2","30455307#0","30455308#1","30455310","30455312#1","30455315","30455326#0","30455326#1","310250930",
"33637670#0","33637690#0","33637703#1","33637703#2","33637703#3","33637798","33888624","455323175","513725891#1","515374861#1","522211496#0","522211496#1","522211508#0","522211508#1","527671263#0","527671263#1","527671264#0","527671264#1","527671265","569567316","569567317#0","569567317#1","589493536","591863728","604710701#0","604710701#1","605884107","605884108","605884109#0","605884110","605884111","605884112#0","605884112#1","605884112#2","605884113","605884114#0",
"605884114#1","605884114#3","605884116","605884117#0","605884117#1","605884119#1","620714856#1","620714857","628017955#0","628017955#10","628017955#11","628017955#12","628017955#13","628017955#2","628017955#3","628017955#4","628017955#6","628017955#7","628017955#8","628017955#9","628017957#0","628017957#1","628017957#2","628024927#0","628024928","628024932#0","628024932#1","628024932#2","628028801","630309658","639411603","720669944",
"720669945","720669946","758374146","784681989","784681991#0","784681991#1","785117596","785117598","785117608#0","785117608#1","785117608#2","785121990","785121991","785121992#0","785121992#1","785121992#2","785121993#0","785121993#1","834913281","836652924#0","836652924#1","836652925","836979909","837014539","837046790#0","837046790#1","859848797","859849281","859853022#0","859853022#2","860765379#1","860765379#2","860765380#2","863539560","951273872",
"952061942","952071777","952071778","952095307","952097963#0","952097963#1","952099092","952110257","952382676","952383763#0","952386968","952386969","952386970","952405506","952419716#0","952419716#1","952455858#0","952455858#1","952462944#0","952462944#1","955366009","955366010","955400312","955400512#0","955400513","968750254","972438415","993169805#0","993169805#1","993169805#2","993169805#3","993169837#1","993169837#2","993169839#0","993169839#1",
"993169840","993169841","993169845","993521589","993521590#0","993521590#1","993521591","993521594#0","993521594#1","993521594#2","993521594#3","993521594#4","993521594#5","995042163","999606366"]


behavior = ["late", "detour"]

fault_prob = 30
prefix = "bus_demo"
with open(prefix+'.trips.xml', 'r') as f:
    data = f.read()

with open(prefix+'.rou.xml', 'r') as f:
    rou = f.read()

file =  open(prefix+"_log.txt", 'w')

# Passing the stored data inside
# the beautifulsoup parser, storing
# the returned object
Bs_data = BeautifulSoup(data, "xml")
Bs_rou = BeautifulSoup(rou, "xml")

# Finding all instances of tag
# `unique`
#b_trips = Bs_data.routes
#b_routes = Bs_rou.routes

for tag in Bs_data.routes.find_all('trip'):
    trip_chance = random.randint(0,99)
    if trip_chance < fault_prob:
        opt = random.choice(behavior)
        #opt = "detour"
        if opt == "detour":
            route =  Bs_rou.routes.find(id=tag["id"])
            edgs = route.route["edges"].split(" ")
            det_orig= random.choice(list(set(net).difference(edgs)))
            det_dest= random.choice(list(set(net).difference(edgs)))
            #tag["via"] = detour
            tag["from"] = det_orig
            tag["to"] = det_dest
            file.write(tag["id"]+"\n")

        else:
            tag["speedFactor"] = "0.6"
            #tag["depart"] = str(float(tag["depart"])+10)
            file.write(tag["id"]+"\n")

out= Bs_data.prettify("utf-8")
with open(prefix+'_det'+str(fault_prob)+'.trips.xml', "wb") as f:
    f.write(out)

file.close()
